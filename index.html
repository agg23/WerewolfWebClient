<html>
    <head>
	    <title>Chat</title>
	    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
		<script src="socket.io.slim.js"></script>
		<script>
		var socket = new WebSocket('wss://werewolf.thehome.stream/socket');
		var createUsername = '';
		var createPassword = '';
		var signInUsername = '';
		var signInPassword = '';
		var nicknameInput = '';
		var joinGameID = '';
		var joinGamePassword = '';
		var hostGameName = '';
		var hostGamePassword = '';
		var charactersInPlay = [];
		var peoplePlayers = [];
		var hostGameID = '';

		function readyUp(){
		   	socket.send(JSON.stringify({'command' : 'ready'}));
		}
		function createAccount(){
		   	socket.send(JSON.stringify({'command' : 'createAccount', 'username' : createUsername, 'password' : createPassword}));
		}
		function signIn(){
		   	socket.send(JSON.stringify({'command' : 'signIn', 'username' : signInUsername, 'password' : signInPassword}));
		}
		function setNickname(){
		   	socket.send(JSON.stringify({'command' : 'setNickname', 'nickname' : nicknameInput}));
		}
		function hostGame(){
		   	socket.send(JSON.stringify({'command' : 'hostGame', 'name' : hostGameName, 'id' : hostGameID, 'password' : hostGamePassword, 'inPlay' : charactersInPlay}));
		}
		function joinGame(){
		   	socket.send(JSON.stringify({'command' : 'joinGame', 'id' : joinGameID, 'password' : joinGamePassword}));
		}

		// Open the socket
		socket.onopen = function(event) {
			
			// Listen for messages
			socket.onmessage = function(event) {
				var parsedEvent = '';

				if(event.data == '__pong__') {

				}
				else {
					console.log('Client received a message',event);
					var parsedEvent = $.parseJSON(event.data);
				}
				if(parsedEvent.command == 'accountCreated') {
					console.log("Logged in as: " + data.username);
				}
				else if(parsedEvent.command == 'response' && parsedEvent.task == 'hostGame') {
					hostGameID = parsedEvent.data.id
					console.log('THIS IS THE GAME ID: ' + hostGameID)
				}
				else if(parsedEvent.command == 'gameUpdate') {
					peoplePlayers = parsedEvent.inPlay;
					charactersInPlay = parsedEvent.players;
					console.log("players: " + peoplePlayers.map(function(item) {return item.name}));
					console.log("humans connected: " + charactersInPlay.map(function(item) {return item.id + " : " + item.ready}));
				}
				else if(parsedEvent.command == 'userSignedIn') {
					console.log("Logged in as: " + data.username);
				}
				else if(parsedEvent.command == 'gotNickname') {
					console.log("New nickname: " + data.nickname);
				}
				else if(parsedEvent.command == 'hostedGame') {
					 console.log("Now hosting a game: " + data.gameID);
				}
				else if(parsedEvent.command == 'joinedGame') {
					console.log("Joined a game: " + data.gameID);
				}
				else if(parsedEvent.command == 'setCharacter') {
					console.log("You are the " + data);
				}
				else if(parsedEvent.command == 'allowedActions') {
					console.log("You are the " + data);
				}
				else if(parsedEvent.command == 'revealCard') {
					console.log("You are the " + data);
				}
				else if(parsedEvent.command == 'gameStarted') {
					console.log("You are the " + data);
				}
				else if(parsedEvent.command == 'gameResults') {
					console.log("You are the " + data);
				}
				
			};
			
			// Listen for socket closes
			socket.onclose = function(event) {
				console.log('Client notified socket has closed',event);
			};

		};
    	jQuery(function($) {
			var $createAccountForm = $('#createAccountForm');
			var $createUsername = $('#createUsername');
			var $createPassword = $('#createPassword');
			var $signInForm = $('#signInForm');
			var $signInUsername = $('#signInUsername');
			var $signInPassword = $('#signInPassword');
			var $nicknameForm = $('#nicknameForm');
			var $nicknameInput = $('#givenNickname');
			var $joinGameForm = $('#joinGameForm');
			var $joinGameID = $('#joinGameID');
			var $joinGamePassword = $('#joinGamePassword');
			var $hostGameForm = $('#hostGameForm');
			var $hostGameName = $('#hostGameName');
			var $hostGamePassword = $('#hostGamePassword');
			var $hostGameCharacters = $('#hostGameCharacters');
			

			setInterval(function() {
				socket.send('__ping__');
			}, 5000);

			$createAccountForm.submit(function(e) {
				e.preventDefault();
				createUsername = $createUsername.val();
				createPassword = $createPassword.val();
			})

			$signInForm.submit(function(e) {
				e.preventDefault();
				signInUsername = $signInUsername.val();
				signInPassword = $signInPassword.val();
			})

			$nicknameForm.submit(function(e) {
				e.preventDefault();
				nicknameInput = $nicknameInput.val();
			})

			$joinGameForm.submit(function(e) {
				e.preventDefault();
				joinGameID = $joinGameID.val();
				joinGamePassword = $joinGamePassword.val();
			})

			$hostGameForm.submit(function(e) {
				e.preventDefault();
				hostGameName = $hostGameName.val();
				hostGamePassword = $hostGamePassword.val();
				charactersInPlay = $hostGameCharacters.val().split(" ");
			})

		});
	    </script>
    </head>
    <p>Welcome To Werewolf!!!</p>
    <body>
	    <div id="Page1">
	    	<button id = "createAccountButton" type="button" onClick = "createAcc()">Create Account</button>
	    	<button id = "signInButton" type="button" onClick = "signIn()">Sign in</button>
	    	<button id = "hostGameButton" type="button" onClick = "hostGame()">Host Game</button>
	    	<button id = "joinGameButton" type="button" onClick = "joinGame()">Join Game</button>
	    	<button id = "readyUpButton" type="button" onClick = "readyUp()">Ready Up</button>
	    	<form id= "createAccountForm">
				<td>username</td>
                <td><input size = "55" id="createUsername"></td>
                <td>password</td>
                <td><input size = "55" id="createPassword" type = "password"></td>
                <td>retype password</td>
                <td><input size = "55" id="createRetypedPassword" type="password"></td>
                <input type = "submit"></input>
			</form>
			<form id= "signInForm">
				<td>username</td>
                <td><input size = "55" id="signInUsername"></td>
                <td>password</td>
                <td><input size = "55" id="signInPassword" type="password"></td>
                <input type = "submit"></input>
			</form>
	    	<form id= "nicknameForm">
	    		<td>Set Nickname</td>
				<td><input size ="55" id="givenNickname"></input></td>
				<td><input type = "submit"></input></td>
			</form>
			<form id= "hostGameForm">
				<td>Create a Game Name</td>
                <td><input size = "55" id="hostGameName"></td>
                <td>Create a Game Password</td>
                <td><input size = "55" id="hostGamePassword" type="password"></td>
                <td>Choose the characters -- all undercase -- space delimitted</td>
                <td><input size = "140" id="hostGameCharacters"></td>
                <input type = "submit"></input>
			</form>
			<form id= "joinGameForm">
				<td>Game ID</td>
                <td><input size = "55" id="joinGameID"></td>
                <td>Game Password</td>
                <td><input size = "55" id="joinGamePassword" type = "password"></td>
                <input type = "submit"></input>
			</form>
	    </div>

    </body>
</html>