<html>
    <head>
	    <title>Chat</title>
	    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
		<script src="socket.io.slim.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>
		<script>
		var socket = new WebSocket('wss://werewolf.thehome.stream/socket');
		var createUsername = '';
		var createPassword = '';
		var signInUsername = '';
		var signInPassword = '';
		var givenNickname = '';
		var joinGameID = '';
		var joinGamePassword = '';
		var hostGameName = '';
		var hostGamePassword = '';
		var charactersInPlay = [];
		var peoplePlayers = [];
		var hostGameID = '';
		var clientsCurrentCharacter = '';

		jQuery(function($) {
			$( "#readyUpButton" ).click(function() {
				readyUp();
			});
			$( "#createAccountButton" ).click(function() {
				createAccount();
			});
			$( "#signInButton" ).click(function() {
				signIn();
			});
			$( "#nicknameButton" ).click(function() {
				setNickname();
			});
			$( "#hostGameButton" ).click(function() {
				hostGame();
			});
			$( "#joinGameButton" ).click(function() {
				joinGame();
			});
		});

		function readyUp(){
		   	socket.send(JSON.stringify({'command' : 'ready'}));
		}
		function createAccount(){
			createUsername = $('#createUsername').val();
			createPassword = $('#createPassword').val();
		   	socket.send(JSON.stringify({'command' : 'createAccount', 'username' : createUsername, 'password' : createPassword}));
		}
		function signIn(){
			signInUsername = $('#signInUsername').val();
			signInPassword = $('#signInPassword').val();
		   	socket.send(JSON.stringify({'command' : 'signIn', 'username' : signInUsername, 'password' : signInPassword}));
		}
		function setNickname(){
			givenNickname = $('#givenNickname').val();
		   	socket.send(JSON.stringify({'command' : 'setNickname', 'nickname' : givenNickname}));
		}
		function hostGame(){
			hostGameName =  $('#hostGameName').val();
			hostGamePassword = $('#hostGamePassword').val();
			charactersInPlay = $('#hostGameCharacters').val().split(" ");
		   	socket.send(JSON.stringify({'command' : 'hostGame', 'name' : hostGameName, 'password' : hostGamePassword, 'inPlay' : charactersInPlay}));
		}
		function joinGame(){
			joinGameID =  $('#joinGameID').val();
			joinGamePassword = $('#joinGamePassword').val();
		   	socket.send(JSON.stringify({'command' : 'joinGame', 'id' : joinGameID, 'password' : joinGamePassword}));
		}

		// Open the socket
		socket.onopen = function(event) {
			
			setInterval(function() {
				socket.send('__ping__');
			}, 5000);

			// Listen for messages
			socket.onmessage = function(event) {
				var parsedEvent = '';

				if(event.data == '__pong__') {

				}
				else {
					console.log('Client received a message',event);
					var parsedEvent = $.parseJSON(event.data);
				}
				if(parsedEvent.command == 'accountCreated') {
					console.log("Logged in as: " + data.username);
				}
				else if(parsedEvent.command == 'response' && parsedEvent.task == 'hostGame') {
					hostGameID = parsedEvent.data.id
					console.log('THIS IS THE GAME ID: ' + hostGameID)
				}
				else if(parsedEvent.command == 'gameUpdate') {
					charactersInPlay = parsedEvent.inPlay;
					peoplePlayers = parsedEvent.players;
					console.log("character in play: " + charactersInPlay.map(function(item) {return item.name}));
					console.log("humans connected: " + peoplePlayers.map(function(item) {return item.id + " : " + item.ready}));
				}
				else if(parsedEvent.command == 'characterUpdate') {
					clientsCurrentCharacter = parsedEvent.character;
					console.log("My new character is : " + clientsCurrentCharacter.name);
				}
				else if(parsedEvent.command == 'userSignedIn') {
					console.log("Logged in as: " + data.username);
				}
				else if(parsedEvent.command == 'gotNickname') {
					console.log("New nickname: " + data.nickname);
				}
				else if(parsedEvent.command == 'hostedGame') {
					 console.log("Now hosting a game: " + data.gameID);
				}
				else if(parsedEvent.command == 'joinedGame') {
					console.log("Joined a game: " + data.gameID);
				}
				else if(parsedEvent.command == 'setCharacter') {
					console.log("You are the " + data);
				}
				else if(parsedEvent.command == 'allowedActions') {
					console.log("You are the " + data);
				}
				else if(parsedEvent.command == 'revealCard') {
					console.log("You are the " + data);
				}
				else if(parsedEvent.command == 'gameStarted') {
					console.log("You are the " + data);
				}
				else if(parsedEvent.command == 'gameResults') {
					console.log("You are the " + data);
				}
				
			};
			
			// Listen for socket closes
			socket.onclose = function(event) {
				console.log('Client notified socket has closed',event);
			};

		};
	    </script>
	    <script type="text/babel">
	    	class Toggle extends React.Component {
		  constructor(props) {
		    super(props);
		    this.state = {isToggleOn: false};

		    // This binding is necessary to make `this` work in the callback
		    this.handleClick = this.handleClick.bind(this);
		  }

		  handleClick() {
		    this.setState(prevState => ({
		      isToggleOn: !prevState.isToggleOn
		    }));
		  }

		  render() {
		    return (
		      <button onClick={this.handleClick} style={{backgroundColor:(this.state.isToggleOn ? 'grey' : 'white')}}>
		        {this.state.isToggleOn ? 'ON' : 'OFF'}
		      </button>
		    );
		  }
		}
	    ReactDOM.render(
		  <Toggle />,
		  document.getElementById('root')
		);






		class App extends React.Component {
		  constructor(props) {
		    super(props);
		    this.state = {isToggleOn: false};
		    this.pages = [{title: 'a', text: 'hello'}, {title: 'b', text: 'world'}];

		    // This binding is necessary to make `this` work in the callback
		    this.handleClick = this.handleClick.bind(this);
		  }
		  handleClick() {
		    this.setState(prevState => ({
		      isToggleOn: !prevState.isToggleOn
		    }));
		  }
		  render() {
		    return (
		      <div>
		        {
		          this.pages.map(function(page) {
		            return <button onClick={this.handleClick} style={{backgroundColor:(this.state.isToggleOn ? 'grey' : 'white')}}>Title: {page.title}. Text: {page.text}</button>;
		          }, this)
		        }
		      </div>
		    );
		  }
		};

		ReactDOM.render(
		  <App />,
		  document.getElementById('root2')
		);
		</script>
    </head>
    <p>Welcome To Werewolf!!!</p>
    <body>
	    <div id="Page1">
		Username : <input size = "25" id="createUsername">
        Password : <input size = "25" id="createPassword" type = "password">
        Retype Password : <input size = "55" id="createRetypedPassword" type="password">
        <p id = "createAccountButton">SUBMIT THE CREATE ACCOUNT BY CLICKING ON ME</p>
		Username : <input size = "25" id="signInUsername">
        Password : <input size = "25" id="signInPassword" type="password">
        <p id = "signInButton">SUBMIT THE SIGN IN BY CLICKING ON ME</p>
		Set Nickname : <input size ="25" id="givenNickname"></input>
		<p id = "nicknameButton">SUBMIT THE NICKNAME BY CLICKING ON ME</p>
		Create a Game Name : <input size = "25" id="hostGameName">
        Create a Game Password : <input size = "25" id="hostGamePassword" type="password">
     	Choose the characters -- all undercase -- space delimitted : <input size = "140" id="hostGameCharacters">
        <p id = "hostGameButton">SUBMIT THE HOST GAME BY CLICKING ON ME</p>
		Game ID : <input size = "25" id="joinGameID">
        Game Password : <input size = "25" id="joinGamePassword" type = "password">
        <p id = "joinGameButton">SUBMIT THE JOIN GAME BY CLICKING ON ME</p>
        <p id = "readyUpButton">Ready Up!</p>
	    </div>
	    <div id = "root"></div>
	    <div id= "root2"></div>
    </body>
</html>